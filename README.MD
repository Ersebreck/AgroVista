# ğŸŒ± AgroVista â€“ GestiÃ³n Inteligente de Terrenos AgrÃ­colas

**AgroVista** es una plataforma visual e interactiva para monitorear, registrar y analizar la actividad de terrenos agrÃ­colas y sus subdivisiones. Utiliza mapas, trazabilidad y registros histÃ³ricos para empoderar a propietarios, administradores y encargados en la toma de decisiones estratÃ©gicas.

> âš ï¸ **Estado Actual**: El proyecto estÃ¡ en proceso de mejora estructural del backend. Se estÃ¡ migrando de una arquitectura monolÃ­tica a una modular con mejor separaciÃ³n de responsabilidades. Ver la secciÃ³n [Estado de Desarrollo](#-estado-de-desarrollo) para mÃ¡s detalles.



## ğŸš€ CaracterÃ­sticas principales

- ğŸ—ºï¸ **VisualizaciÃ³n geoespacial** de terrenos y parcelas con mapas interactivos.
- ğŸ“‹ **Registro de actividades** agrÃ­colas como riego, fertilizaciÃ³n, cosecha, ordeÃ±o, etc.
- ğŸ“Š **Resumen inteligente** del estado de cada parcela (Ã³ptimo, atenciÃ³n, crÃ­tico).
- ğŸ” **Vista detallada** de cada parcela con historial de actividades.
- ğŸ§  **Chatbot agrÃ­cola (experimental)** que responde sobre el estado operativo del campo.
- ğŸ› ï¸ **AdministraciÃ³n CRUD** de terrenos y parcelas vÃ­a API.
- ğŸ§¾ **Preparado para reportes y dashboards personalizados.**

---

## âš™ï¸ TecnologÃ­as utilizadas

| Componente       | TecnologÃ­a                        |
|------------------|-----------------------------------|
| Backend API      | FastAPI + SQLAlchemy              |
| Base de datos    | PostgreSQL + PostGIS              |
| Frontend         | Streamlit + Folium                |
| Geoprocesamiento | GeoAlchemy2, Shapely, GDAL        |
| Embeddings       | LangChain + SentenceTransformers  |
| Contenedores     | Docker (opcional)                 |
| Code Quality     | Ruff (linting/formatting)         |



## ğŸ”§ InstalaciÃ³n local (sin Docker)

### 1. Clonar el repositorio
```bash
git clone https://github.com/ersebreck/agrovista.git
cd agrovista
```

### 2. Crear y activar entorno virtual
```bash
conda create -n agrovista python=3.11
conda activate agrovista
```

### 3. Configurar variables de entorno
```bash
# Copiar el archivo de ejemplo
cp backend/.env.example backend/.env

# Editar con tus valores locales
# Especialmente DATABASE_URL y SECRET_KEY
```

### 4. Instalar dependencias
```bash
# Backend dependencies
cd backend
pip install -r requirements.txt

# Frontend dependencies  
cd ../frontend
pip install -r requirements.txt
cd ..
```

### 5. Iniciar PostgreSQL + PostGIS y poblar la base de datos
```bash
bash agrovista_local_setup.sh
```

Esto activarÃ¡ el entorno, verificarÃ¡ la base de datos y lanzarÃ¡ automÃ¡ticamente el backend y el frontend.

**Alternativamente, para ejecutar manualmente:**
```bash
# Terminal 1: Backend
cd backend && uvicorn app.main:app --reload --port 8000

# Terminal 2: Frontend
cd frontend && streamlit run app.py
```

### 6. Para desarrollo y testing
```bash
# Usar el entorno de desarrollo
cp backend/.env.development backend/.env

# Ejecutar tests unitarios
cd backend
uv run pytest tests/unit/ -v

# O ejecutar todos los tests
uv run pytest tests/ -v

# Linting y formateo con Ruff
ruff check app/ --fix        # Revisar y arreglar issues
ruff format app/            # Formatear cÃ³digo
```



## ğŸ§ª Acceso a la App

- **Backend API (Swagger):** http://localhost:8000/docs
- **Frontend (Mapa interactivo):** http://localhost:8501



## ğŸ§  Estructura del Proyecto

### Estructura Original (En proceso de migraciÃ³n)
```
agrovista/
â”œâ”€â”€ backend/        # API en FastAPI
â”‚   â””â”€â”€ app/
â”‚       â”œâ”€â”€ models.py       # Modelos monolÃ­ticos (migrando)
â”‚       â”œâ”€â”€ schemas.py      # Schemas monolÃ­ticos (migrando)
â”‚       â”œâ”€â”€ routes/         # Rutas existentes (funcionales)
â”‚       â””â”€â”€ ...
â”œâ”€â”€ frontend/       # Interfaz en Streamlit con mapas y chatbot
â”‚   â”œâ”€â”€ app.py            # Entrada principal de la aplicaciÃ³n
â”‚   â””â”€â”€ pages/            # PÃ¡ginas de la aplicaciÃ³n
â”‚       â”œâ”€â”€ _1_Dashboard.py
â”‚       â”œâ”€â”€ _2_Mapa.py
â”‚       â””â”€â”€ _5_Asistente_IA.py
â”œâ”€â”€ agrovista_local_setup.sh   # Script de inicio sin Docker
â””â”€â”€ docker-compose.yml         # ConfiguraciÃ³n para despliegue con contenedores
```

### Nueva Estructura Modular (En construcciÃ³n)
```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ core/               # ConfiguraciÃ³n central
â”‚   â”‚   â”œâ”€â”€ config.py       # ConfiguraciÃ³n con Pydantic Settings âœ…
â”‚   â”‚   â”œâ”€â”€ dependencies.py # InyecciÃ³n de dependencias âœ…
â”‚   â”‚   â”œâ”€â”€ exceptions.py   # Excepciones personalizadas âœ…
â”‚   â”‚   â””â”€â”€ logging.py      # Sistema de logging âœ…
â”‚   â”œâ”€â”€ domain/             # LÃ³gica de dominio
â”‚   â”‚   â”œâ”€â”€ farming/        # Dominio agrÃ­cola ğŸš§
â”‚   â”‚   â”‚   â”œâ”€â”€ models.py   # Modelos de terrenos/parcelas
â”‚   â”‚   â”‚   â””â”€â”€ schemas.py  # Schemas de validaciÃ³n
â”‚   â”‚   â”œâ”€â”€ inventory/      # Dominio de inventario
â”‚   â”‚   â”œâ”€â”€ finance/        # Dominio financiero
â”‚   â”‚   â””â”€â”€ simulation/     # Dominio de simulaciÃ³n
â”‚   â”œâ”€â”€ infrastructure/     # Capa de infraestructura
â”‚   â”‚   â””â”€â”€ repositories/   # PatrÃ³n repositorio
â”‚   â”‚       â”œâ”€â”€ base.py     # Repositorio base genÃ©rico âœ…
â”‚   â”‚       â””â”€â”€ terrain_repository.py âœ…
â”‚   â”œâ”€â”€ application/        # Capa de aplicaciÃ³n
â”‚   â”‚   â””â”€â”€ services/       # Servicios de negocio
â”‚   â”‚       â””â”€â”€ terrain_service.py âœ…
â”‚   â””â”€â”€ api/                # Capa de API
â”‚       â””â”€â”€ v1/             # Versionado de API
â”‚           â””â”€â”€ routes/     # Nuevas rutas ğŸš§
â”œâ”€â”€ tests/                  # Tests mejorados (pendiente)
â””â”€â”€ .env.example            # Variables de entorno âœ…
```



## ğŸš§ Estado de Desarrollo

### Mejoras Estructurales en Progreso

Se estÃ¡ implementando un plan de mejora estructural de 12 semanas dividido en 6 fases:

#### Fase 1: FundaciÃ³n y EstandarizaciÃ³n (Semanas 1-2) - âœ… COMPLETADA
- âœ… **EstandarizaciÃ³n de idioma**: MigraciÃ³n completa de nombres espaÃ±oles a inglÃ©s
- âœ… **Compatibilidad legacy**: Endpoints en espaÃ±ol mantienen funcionalidad
- âœ… **Modelos actualizados**: Todos los modelos de base de datos actualizados
- âœ… **Tests funcionando**: 61/120 tests pasando, estructura de testing robusta
- âœ… **Base de datos inicializada**: Script de poblaciÃ³n de datos funcional
- âœ… **DocumentaciÃ³n de mapeo**: language_mapping.md como referencia
- âœ… Nueva estructura modular de directorios
- âœ… GestiÃ³n de configuraciÃ³n con Pydantic Settings
- âœ… Sistema de logging estructurado

#### Fase 2: Capa de Dominio (Semanas 3-4)
- ğŸš§ DivisiÃ³n de modelos por dominio
- â³ ImplementaciÃ³n de value objects
- â³ ValidaciÃ³n a nivel de dominio
- â³ ExtracciÃ³n de lÃ³gica de negocio

#### Fase 3: Capa de AplicaciÃ³n (Semanas 5-6)
- ğŸš§ ImplementaciÃ³n del patrÃ³n repositorio
- ğŸš§ Capa de servicios
- â³ Casos de uso

#### Fase 4: Capa API (Semanas 7-8)
- ğŸš§ Controladores delgados
- â³ Versionado de API
- â³ Middleware personalizado

#### Fase 5: Testing y Calidad (Semanas 9-10)
- â³ Test factories
- â³ Tests unitarios, integraciÃ³n, E2E
- â³ CI/CD pipeline

#### Fase 6: MigraciÃ³n y Limpieza (Semanas 11-12)
- â³ EliminaciÃ³n de cÃ³digo legacy
- â³ ConversiÃ³n completa a async/await
- â³ OptimizaciÃ³n de performance

### Para Nuevos Desarrolladores

1. **Sistema funcional**: Backend y frontend completamente operativos con base de datos inicializada
2. **Endpoints bilingÃ¼es**: APIs disponibles en inglÃ©s (`/terrains/`) y espaÃ±ol (`/terrenos/`) para compatibilidad
3. **Testing robusto**: Suite de tests con 61 tests pasando, configuraciÃ³n para SQLite en tests
4. **FÃ¡cil inicio**: Usar `bash agrovista_local_setup.sh` para levantar todo el sistema
5. **Consultar documentaciÃ³n**: Ver `CLAUDE.md` para contexto completo del proyecto

## ğŸ§­ Roadmap (Futuro)

- âœ… Dashboards con KPIs
- ğŸš§ Arquitectura modular mejorada
- â³ Registro de costos operativos
- â³ SimulaciÃ³n productiva (rendimiento vs inversiÃ³n)
- â³ App mÃ³vil para recolecciÃ³n en campo
- â³ Acceso multiusuario y control de roles
- â³ ExportaciÃ³n de reportes PDF/Excel



## ğŸ¤ Colaboraciones

Este proyecto naciÃ³ como un MVP prÃ¡ctico pero tiene aplicaciÃ³n real. Si te interesa integrarlo con sensores, visiÃ³n por dron, modelos de predicciÃ³n o gestiÃ³n ganadera, Â¡bienvenido!



## ğŸ‘¨â€ğŸ’» Autor

**Erick SebastiÃ¡n Lozano Roa**  
ğŸ”— [LinkedIn](https://www.linkedin.com/in/erick-lozano) â€“ ğŸ¤– Investigador en IA, optimizaciÃ³n y tecnologÃ­a agrÃ­cola

---
